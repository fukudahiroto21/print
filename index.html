<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>è¨ˆç®—ãƒ—ãƒªãƒ³ãƒˆPDFä½œæˆ</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <h2>ãƒ‡ã‚¶ã‚¤ãƒ³ä»˜ãè¨ˆç®—ãƒ—ãƒªãƒ³ãƒˆä½œæˆ</h2>
  <label>å•é¡Œæ•°ï¼ˆ10ã€œ50ï¼‰: 
    <input type="number" id="numQuestions" value="20" min="10" max="50">
  </label>
  <br><br>
  <button id="createPdfBtn">PDFã‚’ä½œæˆ</button>

  <script>
    window.addEventListener("DOMContentLoaded", () => {
      const { jsPDF } = window.jspdf;

      document.getElementById("createPdfBtn").addEventListener("click", () => {
        const img = new Image();

        // sample.png ãŒ images ãƒ•ã‚©ãƒ«ãƒ€ã«ã‚ã‚‹ã“ã¨ã‚’è€ƒæ…®ã—ãŸãƒ‘ã‚¹
        img.src = "./images/text.png";
        img.crossOrigin = "anonymous"; // GitHub Pageså¯¾ç­–ï¼ˆCORSå›é¿ï¼‰

        img.onload = () => {
          const doc = new jsPDF({
            orientation: 'landscape', // ğŸ‘ˆ æ¨ªå‘ã
            unit: 'mm',
            format: 'a4'
          });
        
          // æ¨ªå‘ãA4ï¼šå¹… 297mm Ã— é«˜ã• 210mm
          doc.addImage(img, 'PNG', 0, 0, 297, 210); // ğŸ‘ˆ ã‚µã‚¤ã‚ºã‚‚å¤‰æ›´


          // å•é¡Œæ•°ã®å–å¾—ï¼ˆ10ã€œ50ï¼‰
          const num = parseInt(document.getElementById("numQuestions").value) || 20;
          const questions = [];

          // è¨ˆç®—å•é¡Œã‚’ç”Ÿæˆ
          for (let i = 0; i < num; i++) {
            const a = Math.floor(Math.random() * 90) + 10;
            const b = Math.floor(Math.random() * 90) + 10;
            const op = Math.random() > 0.5 ? "+" : "-";
            const left = op === "+" ? a : Math.max(a, b);
            const right = op === "+" ? b : Math.min(a, b);
            questions.push(`${left} ${op} ${right} =`);
          }

          // ãƒ•ã‚©ãƒ³ãƒˆè¨­å®š
          doc.setFont("helvetica");
          doc.setFontSize(14);

          // ãƒ†ã‚­ã‚¹ãƒˆå‡ºåŠ›ä½ç½®ã®åˆæœŸå€¤
          let x = 20;
          let y = 50;
          const lineHeight = 10;

          // å•é¡Œã‚’2åˆ—ã§è¡¨ç¤º
          for (let i = 0; i < questions.length; i++) {
            doc.text(questions[i], x, y);
            y += lineHeight;

            // åˆ—ã‚’å¤‰ãˆã‚‹
            if ((i + 1) % (num / 2) === 0) {
              x += 80;
              y = 50;
            }
          }

          // PDFã‚’ä¿å­˜
          doc.save("keisan_print.pdf");
        };

        // ç”»åƒèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼å‡¦ç†
        img.onerror = () => {
          alert("èƒŒæ™¯ç”»åƒï¼ˆimages/sample.pngï¼‰ãŒèª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸã€‚ãƒ‘ã‚¹ã¨ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
        };
      });
    });
  </script>
</body>
</html>
